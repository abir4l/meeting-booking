<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Canvas test</title>
	<style>
		.drawing{
			border: 1px solid #ccc;
			position: absolute;
			top: 150px;
		}

	</style>
</head>
<body>
	
	<a href="#" class="clear-canvas"> Clear canvas</a>

	<canvas class="drawing" width="500px" height="500px">

	</canvas>


	<script>
		const canvas = document.querySelector('.drawing');

		dragTimer = null;

		let firstPosition, finalPosition,drag = false;
		first = {x:95.8125, y: 214},final= {x: 94.8125, y: 213};
		//fillCanvas(first,final);
		document.querySelector('.clear-canvas').addEventListener('click',()=>{
				const context = canvas.getContext('2d');
				context.clearRect(0, 0, canvas.width, canvas.height);
		});

		function getCursorPosition(canvas, event) {
			const rect = canvas.getBoundingClientRect()
			const x = event.clientX - rect.left
			const y = event.clientY - rect.top
			return {x:x,y:y};
		}

		// (x,y,width,height)
		function fillCanvas(first,final) {
			clearTimeout(dragTimer);
			padd = 0;
			let right = canvas.getBoundingClientRect().right;
			var ctx = canvas.getContext("2d");
			if( first.y < final.y){
				ctx.rect(0,first.y,right - padd,final.y - first.y);
				console.log('normal')
				console.log(first,final);
			}
			else if( first.y > final.y){
				ctx.rect(0,final.y,right - padd,first.y-final.y);
				console.log('final first')
				console.log(first,final);
			}
			ctx.fill();
			dragTimer = setTimeout(function(){
				
				console.log('drag timer')
				drag = false;
			
			},500);
			finalPosition = null;


		}


		canvas.addEventListener('mousedown',(ev) =>{
			drag = true;
			firstPosition = getCursorPosition(canvas,ev);
		});

		canvas.addEventListener('mouseup',(ev) =>{
			drag = false;
			
		});

		canvas.addEventListener('mousemove',(ev) =>{
			
			if(drag){
				finalPosition = getCursorPosition(canvas,ev);
				fillCanvas(firstPosition,finalPosition);

			}
		});


	</script>
</body>
</html>
